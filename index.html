<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Buscador BOJA Avanzado</title>
<style>
body { font-family: sans-serif; background: #f5f6f8; color: #222; padding: 2rem; }
h1 { color: #006400; margin-bottom: 1.5rem; }
textarea { width: 100%; height: 180px; padding: 10px; font-size: 1rem;
           border: 1px solid #ccc; border-radius: 8px; resize: vertical; }
button { margin-top: 1rem; margin-right: 0.5rem; padding: 10px 20px; font-size: 1rem;
          border: none; border-radius: 8px; cursor: pointer; color: #fff; }
#buscarExacto { background: #007bff; }
#buscarExacto:hover { background: #0069d9; }
#buscarSimilar { background: #28a745; }
#buscarSimilar:hover { background: #218838; }
#info { margin-top: 2rem; font-weight: bold; white-space: pre-line; }
</style>
</head>
<body>
<h1>üìú Buscador Inteligente del BOJA</h1>

<textarea id="textoBuscado" placeholder="Escribe o pega aqu√≠ las palabras a buscar...">
Subvenciones en r√©gimen de concurrencia no competitiva a organizaciones sindicales para la financiaci√≥n de gastos corrientes
</textarea>
<br>
<button id="buscarExacto">üîé Buscar palabras exactas</button>
<button id="buscarSimilar">üß† Buscar con cierto parecido</button>

<div id="info"></div>

<script>
// -------- Normalizar texto para comparar --------
function normalizarTexto(t) {
  return t
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "")  // quitar tildes
    .replace(/[.,;:()¬ø?!¬°"]/g, "")    // quitar signos SOLO para comparaci√≥n
    .replace(/\s+/g, " ")
    .trim();
}

// -------- Calcular distancia de Levenshtein --------
function distanciaLevenshtein(a, b) {
  const dp = Array.from({ length: a.length + 1 }, () => Array(b.length + 1).fill(0));
  for (let i = 0; i <= a.length; i++) dp[i][0] = i;
  for (let j = 0; j <= b.length; j++) dp[0][j] = j;
  for (let i = 1; i <= a.length; i++) {
    for (let j = 1; j <= b.length; j++) {
      const costo = a[i - 1] === b[j - 1] ? 0 : 1;
      dp[i][j] = Math.min(
        dp[i - 1][j] + 1,
        dp[i][j - 1] + 1,
        dp[i - 1][j - 1] + costo
      );
    }
  }
  return dp[a.length][b.length];
}

// -------- Similitud basada en Levenshtein --------
function similitudLevenshtein(a, b) {
  if (!a.length && !b.length) return 100;
  const dist = distanciaLevenshtein(a, b);
  const maxLen = Math.max(a.length, b.length);
  return Math.round(100 * (1 - dist / maxLen));
}

// -------- B√∫squeda exacta --------
async function buscarExacto() {
  const fraseOriginal = document.getElementById("textoBuscado").value.trim();
  const frase = normalizarTexto(fraseOriginal);
  const info = document.getElementById("info");
  info.textContent = "üîç Buscando palabras exactas...";

  if (!frase) return info.textContent = "‚ö†Ô∏è Escribe algo para buscar.";

  try {
    let textoOriginal = await fetch("sumario.txt").then(r => r.text());
    const textoNormalizado = normalizarTexto(textoOriginal);

    if (textoNormalizado.includes(frase)) {
      info.textContent = "‚úÖ Las palabras exactas se han encontrado en el texto.";
    } else {
      info.textContent = "‚ùå Las palabras exactas no se han encontrado en el texto.";
    }
  } catch (err) {
    info.textContent = "‚ùå Error al cargar el sumario: " + err;
  }
}

// -------- B√∫squeda por similitud (manteniendo signos originales) --------
async function buscarSimilar() {
  const fraseOriginal = document.getElementById("textoBuscado").value.trim();
  const fraseNormalizada = normalizarTexto(fraseOriginal);
  const info = document.getElementById("info");
  info.textContent = "üß† Analizando similitudes...";

  if (!fraseNormalizada) return info.textContent = "‚ö†Ô∏è Escribe algo para buscar.";

  try {
    let textoOriginal = await fetch("sumario.txt").then(r => r.text());

    // Creamos dos versiones: una normalizada (para comparar) y otra original (para mostrar)
    const textoNormalizado = normalizarTexto(textoOriginal);

    const palabrasOriginales = textoOriginal.split(/\s+/);
    const palabrasNormalizadas = textoNormalizado.split(" ");
    const palabrasFrase = fraseNormalizada.split(" ");
    const ventana = palabrasFrase.length;

    let mejorScore = 0;
    let mejorInicio = 0;

    // Recorrer con ventana deslizante
    for (let i = 0; i <= palabrasNormalizadas.length - ventana; i++) {
      const fragmentoNorm = palabrasNormalizadas.slice(i, i + ventana).join(" ");
      const score = similitudLevenshtein(fragmentoNorm, fraseNormalizada);

      if (score > mejorScore) {
        mejorScore = score;
        mejorInicio = i;
      }
    }

    // Recuperar fragmento original (con puntuaci√≥n)
    const mejorFragmento = palabrasOriginales.slice(mejorInicio, mejorInicio + ventana).join(" ");

    info.textContent = `üîç M√°xima similitud: ${mejorScore}%\nüß© Fragmento m√°s parecido:\n${mejorFragmento}`;
  } catch (err) {
    info.textContent = "‚ùå Error al analizar el sumario: " + err;
  }
}

// -------- Eventos --------
document.getElementById("buscarExacto").addEventListener("click", buscarExacto);
document.getElementById("buscarSimilar").addEventListener("click", buscarSimilar);
</script>
</body>
</html>
